<title>Budget Tracker - Investment Profile</title>
<head>
  <!-- Font Awesome -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    rel="stylesheet"
  />
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    rel="stylesheet"
  />
  <!-- MDB -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.6.0/mdb.min.css"
    rel="stylesheet"
  />
</head>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon" />
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet"
  />

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link
    href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
    rel="stylesheet"
  />
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet" />

</head>

<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="/home"><strong>Budget </strong>
      Tracker</a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">

      </ul>

      <a class="nav-link" href="/budget_profile">My Budget</a>
      <a class="nav-link" href="/transaction_history">Transactions</a>
      <a class="nav-link" href="/profile">Account</a>
    </div>
  </div>
</nav>

<section id="contact" class="contact section-bg" style="height: 150px;">
  <div class="container">
    <div class="section-title" data-aos="fade-up">
      <h2 style="font-size: 20px; margin-bottom:10px">{{user}}'s Investments</h2>
      <footer style="font-size: 13px;">Stock Market Searching Coming Soon!</footer>
      <footer style="font-size: 13px;">Example Stock Search Process:
        <a href="https://github.com/apollomoon-ucf/Stock_Search_WebApp">GitHub:
          Stock Searcher by Brian Moon</a></footer>
    </div>
  </div>
</section>

<section id="hero" style="margin-top: 0; padding-top:3%">

  <div class="container">

    <div class="row">
      <div class="justify-content-center" data-aos="fade-up">

        <div class="w3-container">

          <h5>Investment Details</h5>
          <footer>If any investment information is available for the account you
            linked with Plaid, trades for the past 6 months will be displayed
            below:</footer>
            <footer style="font-size: 11px;">(More features coming soon! (binary search for multiple search efficiency, etc.)</footer>
          <br style="line-height: 100%;" />
          <form onkeydown="return event.key != 'Enter';" class="row g-3">
            <div class="col-auto">
              <label class="sr-only" for="inlineFormInputName">Name</label>
              <input
                type="text"
                class="form-control"
                id="inlineFormInputName"
                placeholder="How many months?"
                style="width:min-content; text-align:center; font-size:14px"
              />
            </div>
            <div class="col-auto">
              <button
                style="color: rgb(129, 129, 129); font-size:13px"
                type="button"
                class="btn"
                onclick="showNumMonthsOfTransactions(document.getElementById('inlineFormInputName').value)"
              >Submit</button>
            </div>
            <div class="col-auto">
              <input
                type="text"
                class="form-control"
                id="inlineFormInputName2"
                placeholder="Search Name"
                style="width:min-content; text-align:center; font-size:14px"
              />
            </div>
            <div class="col-auto">
              <button
                style="color: rgb(129, 129, 129); font-size:13px"
                type="button"
                class="btn"
                onclick="searchForName(document.getElementById('inlineFormInputName2').value)"
              >Submit</button>
            </div>              
            <div class="col-auto">
              <button
                style="color: rgb(129, 129, 129); font-size:13px"
                type="button"
                class="btn"
                onclick="quickSortTransactions()"
              >Quicksort By Amount</button>
            </div>
            <div class="col-auto">
              <button
                style="color: rgb(129, 129, 129); font-size:13px"
                type="button"
                class="btn"
                onclick="sortTransactionsByDate()"
              >Sort By Date</button>
            </div>
          </form>            

          <table class="table table-hover">
            <thead>
              <tr>

                <th scope="col">Date</th>
                <th scope="col">Name</th>
                {{! <th scope="col">Category</th> }}
                <th scope="col">Amount</th>
              </tr>
            </thead>

            <tbody id="investmentsID">
              {{!-- {{#each transaction.transactions}}
                <tr>
                  <td>{{date}}</td>
                  <td>{{name}}</td>
                  <td>{{category}}</td>
                  <td>{{amount}}</td>
                </tr>
              {{/each}} --}}
            </tbody>
          </table>

          {{#section "investment_chart"}}
            <style>
              #bardiv { width: 100%; height: 500px; }

            </style>

          {{/section}}

          {{!-- <h5>
    {{#each message.transactions}} {{category}}: {{amount}}<br /> {{/each}}</h5> --}}

          {{!-- <table
            class="w3-table w3-striped w3-bordered w3-border w3-hoverable w3-white"
          >
            <td>
              {{#each investment.investment_transactions}}
                {{name}}<br />
                Amount: ${{amount}}<br /><br />
              {{/each}}
            </td>
          </table><br /> --}}

        </div>
      </div>

    </div>
  </div>

</section>

<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />

<div class="container">
  {{! <h6><strong>Note: Web app currently in development.</strong><h6/> }}
  {{! <footer>For testing, use the following credentials for Chase Bank.</footer>
  <footer> Username: user_good</footer>
  <footer>Password: pass_good</footer> }}
</div>

<a
  href="#"
  class="back-to-top d-flex align-items-center justify-content-center"
><i class="bi bi-arrow-up-short"></i></a>

<!-- Vendor JS Files -->
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>


{{! To-Do: move these scripts to their respective js files }}
<script type="text/javascript">
  var array = []; var object = {}; var sortedByDate = [];
  var numberOfMonthsFromUser = 2; var d = new Date(); month = d.getMonth();
  var i = 0;
  transactionsID = document.getElementById("investmentsID");
  transactionsID.innerHTML = "";
  {{#each investment.investment_transactions}}
    object = {date: '{{date}}', name: '{{name}}', amount: '{{amount}}'}; 
    array.push(object); sortedByDate.push(object);
    if(parseInt(sortedByDate[i].date.substring(5, 7)) > (month + 1) - numberOfMonthsFromUser) {
    transactionsID.innerHTML += "<tr><td>" + sortedByDate[i].date + "</td><td>" +
    sortedByDate[i].name + "</td><td>" + sortedByDate[i].amount + "</td></tr>"; } 
    i = i + 1;
  {{/each}}
</script>

<script type="text/javascript">
 function showNumMonthsOfTransactions(numberOfMonths) {
    numberOfMonthsFromUser = numberOfMonths;
  transactionsID = document.getElementById("investmentsID");
  transactionsID.innerHTML = " "; for (var i = 0; i < array.length; i++) { if(
  parseInt(array[i].date.substring(5, 7)) > (month + 1) - numberOfMonths) {
  transactionsID.innerHTML += "<tr><td>" + array[i].date + "</td><td>" +
  array[i].name + "</td><td>" + array[i].amount + "</td></tr>"; } } }
</script>


{{! using quick sort since we are dealing with arrays and not linked lists }}
<script>
  function quickSortTransactions() {
    quickSort(array, 0, array.length - 1);

    transactionsID = document.getElementById("investmentsID");
      transactionsID.innerHTML = " "; for (var i = 0; i < array.length; i++) { if(
      parseInt(array[i].date.substring(5, 7)) > (month + 1) - numberOfMonthsFromUser) {
      transactionsID.innerHTML += "<tr><td>" + array[i].date + "</td><td>" +
      array[i].name + "</td><td>" + array[i].amount + "</td></tr>"; } }


  }

   function quickSort(transactionArray, startIndex, endingIndex) {
      if (startIndex >= endingIndex) {
        return;
      }
      const pivotIndex = startIndex;
      let leftIndex = startIndex + 1;
      let rightIndex = endingIndex;
      while(rightIndex >= leftIndex) {
        if(parseFloat(transactionArray[leftIndex].amount) > parseFloat(transactionArray[pivotIndex].amount) && parseFloat(transactionArray[rightIndex].amount) < parseFloat(transactionArray[pivotIndex].amount)) {
          swapThese(leftIndex, rightIndex, transactionArray);
        }
        if(parseFloat(transactionArray[leftIndex].amount) <= parseFloat(transactionArray[pivotIndex].amount)) {
          leftIndex++;
        }
        if(parseFloat(transactionArray[rightIndex].amount) >= parseFloat(transactionArray[pivotIndex].amount)) {
          rightIndex--;
        }        
      }
      swapThese(pivotIndex, rightIndex, transactionArray);
      const leftSubArraySmaller = rightIndex - 1 - startIndex < endingIndex - (rightIndex + 1);
      if(leftSubArraySmaller) {
        quickSort(transactionArray, startIndex, rightIndex - 1);
        quickSort(transactionArray, rightIndex + 1, endingIndex);
      } else {
        quickSort(transactionArray, rightIndex + 1, endingIndex);
        quickSort(transactionArray, startIndex, rightIndex - 1);
      }
   }

   function swapThese (i, j , transactionArray) {
     let temp = transactionArray[j];
     transactionArray[j] = transactionArray[i];
     transactionArray[i] = temp;
   }

  
</script>


{{!-- sort transactions by date --}}
<script>
  function sortTransactionsByDate() {
    transactionsID = document.getElementById("investmentsID");
      transactionsID.innerHTML = " "; for (var i = 0; i < sortedByDate.length; i++) { if(
      parseInt(sortedByDate[i].date.substring(5, 7)) > (month + 1) - numberOfMonthsFromUser) {
      transactionsID.innerHTML += "<tr><td>" + sortedByDate[i].date + "</td><td>" +
      sortedByDate[i].name + "</td><td>" + sortedByDate[i].amount + "</td></tr>"; } }
  }
</script>

<script>
  function searchForName(name) {
    transactionsID = document.getElementById("investmentsID");
    transactionsID.innerHTML = " "; 
    for (var i = 0; i < sortedByDate.length; i++) { if(
      parseInt(sortedByDate[i].date.substring(5, 7)) > (month + 1) - numberOfMonthsFromUser && sortedByDate[i].name.toLowerCase().includes(name.toLowerCase()) == true) {
      transactionsID.innerHTML += "<tr><td>" + sortedByDate[i].date + "</td><td>" +
      sortedByDate[i].name + "</td><td>" + sortedByDate[i].amount + "</td></tr>"; } }    
  }
</script>