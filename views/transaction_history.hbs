{{! <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"
></script>
<script>
  (async ($) => { const fetchLinkToken = async () => { const response = await
  fetch("/create-link-token"); const { linkToken } = await response.json();
  return linkToken; }; const handler = Plaid.create({ token: await
  fetchLinkToken(), onSuccess: async (publicToken, metadata) => {
  console.log(publicToken); console.log(metadata); await
  fetch("/token-exchange", { method: "POST", body: JSON.stringify({ publicToken
  }), headers: { "Content-Type": "application/json", }, }); }, onExit: async
  (error, metadata) => { console.log(error); console.log(metadata); }, onEvent:
  async (metadata) => { console.log(metadata); }, });
  $("#plaid-button").on("click", function (e) { handler.open(); }); })(jQuery);
</script> }}

<title>Budget Tracker - Transaction History</title>

<head>
  <!-- Font Awesome -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    rel="stylesheet"
  />
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    rel="stylesheet"
  />
  <!-- MDB -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.6.0/mdb.min.css"
    rel="stylesheet"
  />
</head>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon" />
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet"
  />

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link
    href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
    rel="stylesheet"
  />
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet" />

</head>

<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="/home"><strong>Budget </strong>
      Tracker</a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">

      </ul>

      <a class="nav-link" href="/budget_profile">My Budget</a>
      <a class="nav-link" href="/investment_profile">Investments</a>
      <a class="nav-link" href="/profile">Account</a>
    </div>
  </div>
</nav>

<section id="contact" class="contact section-bg" style="height: 150px;">
  <div class="container">
    <div class="section-title" data-aos="fade-up">
      <h2 style="font-size: 20px; margin-bottom:15px">{{user}}'s Transactions</h2>
      <h5>{{month}} 2021</h5>
      <footer style="font-size: 1px;">Displaying all transactions for the month
        of
        {{month}}:</footer>
    </div>
  </div>
</section>

<section id="hero" style="margin-top: 0; padding-top:3%;">

  <div class="container table-responsive">
    <div class="row">
      <div class="justify-content-center" data-aos="fade-up">
        <div class="w3-container">
          <h5>Transaction History</h5>
          <footer>After linking your bank account with Plaid, all transactions
            for the selected number of months (up to 3) will be displayed below.</footer>
            <footer style="font-size: 11px;">(More features coming soon! (binary search for multiple search efficiency, etc.)</footer>
          <br style="line-height: 100%;" />
          <form onkeydown="return event.key != 'Enter';" class="row g-3">
            <div class="col-auto">
              <label class="sr-only" for="inlineFormInputName">Name</label>
              <input
                type="text"
                class="form-control"
                id="inlineFormInputName"
                placeholder="How many months?"
                style="width:min-content; text-align:center; font-size:14px"
              />
            </div>
            <div class="col-auto">
              <button
                style="color: rgb(129, 129, 129); font-size:13px"
                type="button"
                class="btn"
                onclick="showNumMonthsOfTransactions(document.getElementById('inlineFormInputName').value)"
              >Submit</button>
            </div>
            <div class="col-auto">
              <input
                type="text"
                class="form-control"
                id="inlineFormInputName2"
                placeholder="Search Name"
                style="width:min-content; text-align:center; font-size:14px"
              />
            </div>
            <div class="col-auto">
              <button
                style="color: rgb(129, 129, 129); font-size:13px"
                type="button"
                class="btn"
                onclick="searchForName(document.getElementById('inlineFormInputName2').value)"
              >Submit</button>
            </div>              
            <div class="col-auto">
              <button
                style="color: rgb(129, 129, 129); font-size:13px"
                type="button"
                class="btn"
                onclick="quickSortTransactions()"
              >Quicksort By Amount</button>
            </div>
            <div class="col-auto">
              <button
                style="color: rgb(129, 129, 129); font-size:13px"
                type="button"
                class="btn"
                onclick="sortTransactionsByDate()"
              >Sort By Date</button>
            </div>
          
            
            
          </form>

          <table class="table table-hover">
            <thead>
              <tr>

                <th scope="col">Date</th>
                <th scope="col">Name</th>
                <th scope="col">Category</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>

            <tbody id="transactionsID">
              {{!-- {{#each transaction.transactions}}
                <tr>
                  <td>{{date}}</td>
                  <td>{{name}}</td>
                  <td>{{category}}</td>
                  <td>{{amount}}</td>
                </tr>
              {{/each}} --}}
            </tbody>
          </table>

          {{!-- <h5>
              {{#each message.transactions}} {{category}}: {{amount}}<br /> {{/each}}</h5> --}}

          {{!-- <table
            class="w3-table w3-striped w3-bordered w3-border w3-hoverable w3-white"
          >
            <td>
              {{#each transaction.transactions}}
                <li>8/05/21 - {{category}}</li><br />
                Amount: ${{amount}}<br /><br />
              {{/each}}

            </td>
          </table><br /> --}}
        </div>
      </div>

    </div>
  </div>

</section>

<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />

<div class="container">
  {{! <h6><strong>Note: Web app currently in development.</strong><h6/> }}
  {{! <footer>For testing, use the following credentials for Chase Bank.</footer>
  <footer> Username: user_good</footer>
  <footer>Password: pass_good</footer> }}
            <a href="/investment_profile" class="w3-button w3-dark-grey">View any investment data linked to this account
            <i class="fa fa-arrow-right"></i></a>
</div>



<a
  href="#"
  class="back-to-top d-flex align-items-center justify-content-center"
><i class="bi bi-arrow-up-short"></i></a>

<!-- Vendor JS Files -->
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>

{{! To-Do: move these scripts to their respective js files }}
<script type="text/javascript">
  var array = []; var object = {}; var sortedByDate = [];
  var numberOfMonthsFromUser = 1; var d = new Date(); month = d.getMonth();
  var i = 0;
  transactionsID = document.getElementById("transactionsID");
  transactionsID.innerHTML = " ";
  {{#each transaction.transactions}}
    object = {date: '{{date}}', name: '{{name}}', category: '{{category}}',
    amount: '{{amount}}'}; array.push(object); sortedByDate.push(object);
    if(parseInt(sortedByDate[i].date.substring(5, 7)) > (month + 1) - numberOfMonthsFromUser) {
    transactionsID.innerHTML += "<tr><td>" + sortedByDate[i].date + "</td><td>" +
    sortedByDate[i].name + "</td><td>" + sortedByDate[i].category.split(',').shift() +
    "</td><td>" + sortedByDate[i].amount + "</td></tr>"; } 
    i = i + 1;
  {{/each}}
</script>

<script type="text/javascript">
 function showNumMonthsOfTransactions(numberOfMonths) {
    numberOfMonthsFromUser = numberOfMonths;
  transactionsID = document.getElementById("transactionsID");
  transactionsID.innerHTML = " "; for (var i = 0; i < array.length; i++) { if(
  parseInt(array[i].date.substring(5, 7)) > (month + 1) - numberOfMonths) {
  transactionsID.innerHTML += "<tr><td>" + array[i].date + "</td><td>" +
  array[i].name + "</td><td>" + array[i].category.split(',').shift() +
  "</td><td>" + array[i].amount + "</td></tr>"; } } }
</script>


{{! using quick sort since we are dealing with arrays and not linked lists }}
<script>
  function quickSortTransactions() {
    quickSort(array, 0, array.length - 1);

    transactionsID = document.getElementById("transactionsID");
      transactionsID.innerHTML = " "; for (var i = 0; i < array.length; i++) { if(
      parseInt(array[i].date.substring(5, 7)) > (month + 1) - numberOfMonthsFromUser) {
      transactionsID.innerHTML += "<tr><td>" + array[i].date + "</td><td>" +
      array[i].name + "</td><td>" + array[i].category.split(',').shift() +
      "</td><td>" + array[i].amount + "</td></tr>"; } }


  }

   function quickSort(transactionArray, startIndex, endingIndex) {
      if (startIndex >= endingIndex) {
        return;
      }
      const pivotIndex = startIndex;
      let leftIndex = startIndex + 1;
      let rightIndex = endingIndex;
      while(rightIndex >= leftIndex) {
        if(parseFloat(transactionArray[leftIndex].amount) > parseFloat(transactionArray[pivotIndex].amount) && parseFloat(transactionArray[rightIndex].amount) < parseFloat(transactionArray[pivotIndex].amount)) {
          swapThese(leftIndex, rightIndex, transactionArray);
        }
        if(parseFloat(transactionArray[leftIndex].amount) <= parseFloat(transactionArray[pivotIndex].amount)) {
          leftIndex++;
        }
        if(parseFloat(transactionArray[rightIndex].amount) >= parseFloat(transactionArray[pivotIndex].amount)) {
          rightIndex--;
        }        
      }
      swapThese(pivotIndex, rightIndex, transactionArray);
      const leftSubArraySmaller = rightIndex - 1 - startIndex < endingIndex - (rightIndex + 1);
      if(leftSubArraySmaller) {
        quickSort(transactionArray, startIndex, rightIndex - 1);
        quickSort(transactionArray, rightIndex + 1, endingIndex);
      } else {
        quickSort(transactionArray, rightIndex + 1, endingIndex);
        quickSort(transactionArray, startIndex, rightIndex - 1);
      }
   }

   function swapThese (i, j , transactionArray) {
     let temp = transactionArray[j];
     transactionArray[j] = transactionArray[i];
     transactionArray[i] = temp;
   }

  
</script>


{{!-- sort transactions by date --}}
<script>
  function sortTransactionsByDate() {
    transactionsID = document.getElementById("transactionsID");
      transactionsID.innerHTML = " "; for (var i = 0; i < sortedByDate.length; i++) { if(
      parseInt(sortedByDate[i].date.substring(5, 7)) > (month + 1) - numberOfMonthsFromUser) {
      transactionsID.innerHTML += "<tr><td>" + sortedByDate[i].date + "</td><td>" +
      sortedByDate[i].name + "</td><td>" + sortedByDate[i].category.split(',').shift() +
      "</td><td>" + sortedByDate[i].amount + "</td></tr>"; } }
  }
</script>

<script>
  function searchForName(name) {
    transactionsID = document.getElementById("transactionsID");
    transactionsID.innerHTML = " "; 
    for (var i = 0; i < sortedByDate.length; i++) { if(
      parseInt(sortedByDate[i].date.substring(5, 7)) > (month + 1) - numberOfMonthsFromUser && sortedByDate[i].name.toLowerCase().includes(name.toLowerCase()) == true) {
      transactionsID.innerHTML += "<tr><td>" + sortedByDate[i].date + "</td><td>" +
      sortedByDate[i].name + "</td><td>" + sortedByDate[i].category.split(',').shift() +
      "</td><td>" + sortedByDate[i].amount + "</td></tr>"; } }    
  }
</script>

{{! <p>Budget Profile, Investment Profile, and Transaction History will be available
  upon successful connection to your bank account.</p> }}

{{!-- <div class="w3-row-padding w3-margin-bottom">
  <div class="w3-quarter">
    <div class="w3-container w3-red w3-padding-16">
      <div class="w3-left"><i class="fa fa-money w3-xlarge"></i></div>
      <div class="w3-right">
        {{! <h3>52</h3> }}
      </div>
      <a href="/budget_profile" class="w3-clear"></a>
      <h4>Budget Profile</h4>
    </div>
  </div>
  <div class="w3-quarter">
    <div class="w3-container w3-teal w3-padding-16">
      <div class="w3-left"><i class="fa fa-history w3-xlarge"></i></div>
      <div class="w3-right">
        {{! <h3>23</h3> }}
      </div>
      <a href="/transaction_history" class="w3-clear"></a>
      <h4>Transaction History</h4>
    </div>
  </div>
  <div class="w3-quarter">
    <div class="w3-container w3-blue w3-padding-16">
      <div class="w3-left"><i class="fa fa-bank w3-xlarge"></i></div>
      <div class="w3-right">
        {{! <h3>99</h3> }}
      </div>
      <a href="/investment_profile" class="w3-clear"></a>
      <h4>Investment Profile</h4>
    </div>
  </div>
  <div class="w3-quarter">
    <div class="w3-container w3-orange w3-text-white w3-padding-16">
      <div class="w3-left"><i class="fa fa-cog w3-xlarge"></i></div>
      <div class="w3-right">
        {{! <h3>50</h3> }}
      </div>
      <a href="/account_settings" class="w3-clear"></a>
      <h4>Account Settings</h4>
    </div>
  </div>
</div> --}}